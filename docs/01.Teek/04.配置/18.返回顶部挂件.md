---
categories:
- Teek
coverImg: /home/bg2.webp
date: 2025-05-09 14:13:08
description: 基于在 VitePress 主题中实现返回顶部挂件,基于 Vue 3 组合式 API 实现可视化滚动进度条与平滑返回顶部功能，动态进度计算与视口联动；RAF动画帧性能优化;响应式设计适配多端;组件化消息反馈集成;浏览器兼容性处理（Safari特别适配）
permalink: /Teek/34bc87
title: 返回顶部挂件
titleTag: 原创
top: true
---
## 新建组件

在`docs\.vitepress\theme\components`文件夹下新建`CatBackToTop.vue`文件
::: tip 提示
[挂件样式获取](https://img.seasir.top/2025/05/09/17/10/17/scroll_1746781817864.gif)
:::

```vue
// 返回顶部挂件
<template>
  <div
    class="back_to_top"
    ref="toTop"
    :style="{
      top: top + 'px',
    }"
    @click="topTop"
  ></div>
</template>
<script setup lang="ts" name="BackToTop">
import { useRoute } from "vitepress";
import { nextTick, onUnmounted, ref, watch } from "vue";
import { TkMessage } from "vitepress-theme-teek";
import { onMounted } from "vue";

const route = useRoute();
const toTop = ref();
const top = ref<number>(-900);
const offsetHeight = ref<number>(0);

const topTop = () => {
  top.value = -900;
  window.scrollTo({
    top: 0,
    behavior: "smooth",
    // @ts-ignore Safari兼容
    ...(typeof CSS !== "undefined" && CSS.supports("scroll-behavior", "smooth")
      ? {}
      : { left: 0 }),
  });
  TkMessage.success({
    message: "已达到顶部🎉",
    duration: 3000,
  });
};

let animationFrame: number | null = null;

const backToTop = () => {
  if (!animationFrame) {
    animationFrame = requestAnimationFrame(() => {
      const { documentElement } = document;
      // 批量读取
      const measurements = {
        offsetHeight: documentElement.offsetHeight,
        scrollTop: documentElement.scrollTop,
      };
      // 批量更新
      if (measurements.scrollTop < 100) {
        top.value = -900;
      } else {
        top.value =
          (900 - (measurements.scrollTop / measurements.offsetHeight) * 900) *
          -1;
      }
      animationFrame = null;
    });
  }
};

onUnmounted(() => {
  window.removeEventListener("scroll", backToTop);
});

onMounted(() => {
  // 初始化DOM相关操作
  offsetHeight.value = document.documentElement.offsetHeight;

  // 路由变化时更新高度
  watch(
    () => route.path,
    () => {
      nextTick(() => {
        offsetHeight.value = document.querySelector("html")!.offsetHeight;
      });
    },
    { immediate: true }
  );

  // 添加滚动事件监听
  window.addEventListener("scroll", backToTop);
});
</script>
<style lang="scss" scoped>
@keyframes float {
  0% {
    -webkit-transform: translateY(0);
    -ms-transform: translateY(0);
    transform: translateY(0);
  }

  50% {
    -webkit-transform: translateY(-10px);
    -ms-transform: translateY(-10px);
    transform: translateY(-10px);
  }

  100% {
    -webkit-transform: translateY(0);
    -ms-transform: translateY(0);
    transform: translateY(0);
  }
}

.back_to_top {
  cursor: pointer;
  position: fixed;
  left: 25px;
  top: -900px;
  z-index: 1000;
  width: 70px;
  height: 900px;
  background: url("/backToTop/scroll.gif");
  transition: all 0.5s ease-in-out;
  opacity: 1;

  // 新增移动端隐藏
  @media (max-width: 768px) {
    background: none;
    pointer-events: none;
    width: 0;
    height: 0;
  }

  &:hover {
    animation: float 2s linear infinite;
  }
}
</style>
```

## 注册组件

在`docs\.vitepress\theme\components\TeekLayoutProvider.vue`中注册`CatBackToTop.vue`组件

```vue {3,10-11}
<script setup lang="ts" name="TeekLayoutProvider">
// @ts-ignore
import CatBackToTop from "./CatBackToTop.vue"; //导入返回顶部组件  // [!code focus]
</script>

<template>
  <Teek.Layout>
    <template #layout-top>
      // [!code focus:2]
      <!--返回顶部组件  -->
      <CatBackToTop />
    </template>
    其他组件...
  </Teek.Layout>
</template>
```

## 效果展示

![250509142904138.png](https://img.seasir.top/2025/05/09/14/29/04/250509142904138_1746772144187.png)

## 其他拓展

- 默认移动端不显示，如果需要显示，可注释`BackToTop.vue`中的代码

```scss
@media (max-width: 768px) {
  background: none;
  pointer-events: none;
  width: 0;
  height: 0;
}
```

- 控制挂件左右距离

```scss
.back_to_top {
  right: 40px;
}
```

- 如果需要返回顶部挂件高度和 body 一致，可以修改`BackToTop.vue`中的代码，列如`900`改为`100`

```ts {9}
const backToTop = () => {
  if (!animationFrame) {
    animationFrame = requestAnimationFrame(() => {
      offsetHeight.value = document.documentElement.offsetHeight;
      const scrollTop = document.documentElement.scrollTop;
      if (scrollTop < 100) {
        top.value = -900;
      } else {
        top.value = (900 - (scrollTop / offsetHeight.value) * 900) * -1; // [!code focus]
      }
      animationFrame = null;
    });
  }
};
```
