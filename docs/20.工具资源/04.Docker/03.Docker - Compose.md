---
categories:
- Docker
coverImg: /home/bg24.webp
date: 2025-05-17 20:33:17
permalink: /Tool/Docker/Compose
tags:
- 容器部署
title: Docker - Compose
---
## 简介

[Docker-compose 官网](https://docs.docker.com/compose/)

[Docker-compose 指令地址](https://docs.docker.com/compose/reference/)

<span style="color:red">Compose</span> 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的 **快速编排**。从功能上看，跟 `OpenStack` 中的 `Heat` 十分类似。

其代码目前在 <https://github.com/docker/compose> 上开源。

<span style="color:red">Compose</span> 定位是「定义和运行多个 Docker 容器的应用(Defining and running multi-container Docker applications)」，其前身是开源项目 Fig。

在第一部分中的介绍，我们知道使用一个 `Dockerfile` 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡。

<span style="color:red">Compose</span> 恰好满足了这样的需求。它允许用户通过一个单独的 `docker-compose.yml` 模板文件（HAML 格式）来定义一组相关联的应用容器为一个项目（project）。

<span style="color:red">Compose</span> 中有两个重要的概念:

- 服务（service）:一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。

- 项目（ project）：由一组关联的应用容器组成的一个完整业务单元，在 `docker-compose.yml` 文件中定义。

<span style="color:red">Compose</span> 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。

<span style="color:red">Compose</span> 项目由 Python 编写，实现上调用了 Docer 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker APl，就可以在其上利用 <span style="color:red">Compose</span> 来进行编排管理。

::: note

<span style="color:red">Compose</span> 就是一个 yml 文件，利用文件来替代 `docker run` 指令，大部分指令该指令存在的选项如 `--name` 等，<span style="color:red">Compose</span> 都有。

::: right

2025-05-17 @Hyde

:::

## 使用

相关概念

首先介绍几个术语：

- 服务（service）：一个服务就是一个应用容器，实际上可以运行多个相同镜像的实例
- 项目（Project）：由多个服务共同组成一个具有相同的业务逻辑单元，项目在 docker-compose.yml 里定义

使用 Compose 基本上是一个三步过程：

1. 使用定义您的应用程序的环境，`Dockerfile` 以便它可以在任何地方复制。
2. 定义组成您的应用程序的服务，`docker-compose.yml` 以便它们可以在隔离的环境中一起运行。
3. 运行 `docker compose up` 和 [Docker compose command ](https://docs.docker.com/compose/cli-command/)启动并运行你的整个应用程序。您也可以 `docker-compose up` 使用 docker-compose 二进制文件运行。

一个 `docker-compose.yml` 看起来像这样：

```yml
version: "3.9" # 3.9 要求版本大于等于 v1.27.0
services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - .:/code
      - logvolume01:/var/log
    links:
      - redis
  redis:
    image: redis
volumes:
  logvolume01: {}
```

## 安装与卸载

### 安装

- Linux

  在 Linux 上的也安装十分简单，从官方 Gitub Release 处直接下载编译好的二进制文件即可。例如，在 Linux 64 位系统上直接下载对应的二进制包,

  ```sh
  sudo curl -L "https://github.com/docker/compose/releases/download/v2.36.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
  ```

  要安装不同版本的 Compose，请替换 `2.36.0` 为您要使用的 Compose 版本。它将下载到 `/usr/local/bin/` 目录。这是全局指令目录，建议放到这里。

- 对二进制文件应用可执行权限：

  ```sh
  sudo chmod +x /usr/local/bin/docker-compose
  ```

- 测试安装结果
  ```sh
  docker-compose --version
  ```

### 卸载

如果是二进制包方式安装的，删除二进制文件即可。

```sh
sudo rm /usr/local/bin/docker-compose
```

如果您使用 `pip` 以下命令安装，则卸载 Docker Compose ：

```sh
spip uninstall docker-compose
```
